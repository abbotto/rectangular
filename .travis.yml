language: node_js

node_js:
  - "6.10"

cache:
  yarn: true
  directories:
    - node_modules

branches:
  only:
    - master

before_script:
  - . ~/.nvm/nvm.sh && nvm i 6.10

script:
  - yarn --ignore-engines --ignore-platform > /dev/null && node_modules/eslint/bin/eslint.js --quiet --fix --ext .json --ext .js .
  - projectName="ci-app"
  - projectDescription="continuous integration application"
  - projectLicense="MIT"
  - projectAuthor="rectangular"
  - mkdir "$projectName" && cd "$projectName"
  - curl -O -s https://raw.githubusercontent.com/abbotto/rectangular/master/install/package.js > /dev/null
  - curl -O -s https://raw.githubusercontent.com/abbotto/rectangular/master/install/project/package.json > /dev/null
  - node package.js "$projectName" "$projectDescription" "$projectLicense" "$author" && rm package.js
  - npm i abbotto/rectangular
  - mkdir node_modules/rectangular/tmp
  - mkdir node_modules/rectangular/tmp/project
  - cp -a node_modules/rectangular/install/project/. node_modules/rectangular/tmp/project/
  - cp package.json node_modules/rectangular/tmp/project/
  - cd node_modules/rectangular/tmp/project
  - yarn add --ignore-engines --ignore-platform bootstrap angular-strap
  - yarn add --ignore-engines --ignore-platform angular-material
  - yarn add --ignore-engines --ignore-platform bluebird
  - yarn add --ignore-engines --ignore-platform moment
  - yarn add --ignore-engines --ignore-platform angular-moment
  - yarn add --ignore-engines --ignore-platform lodash
  - yarn add --ignore-engines --ignore-platform angular-translate
  - yarn add --ignore-engines --ignore-platform restangular
  - yarn add --ignore-engines --ignore-platform ng-file-upload
  - yarn add --ignore-engines --ignore-platform immutable
  - yarn add --ignore-engines --ignore-platform teleprint
  - cd ../../
  - cp .envrc .env
  - cp -a install/extra/extension/ng-strap/. tmp/project/app/extension/ng-strap/
  - cp -a install/extra/shared/service/ui/bootstrap/. tmp/project/app/shared/service/ui/
  - cp -a install/extra/extension/angular-material/. tmp/project/app/extension/angular-material/
  - cp -a install/extra/shared/service/ui/material-design/. tmp/project/app/shared/service/ui/
  - cp -a install/extra/extension/bluebird/. tmp/project/app/extension/bluebird/
  - cp -a install/extra/shared/service/promise/. tmp/project/app/shared/service/promise/
  - cp -a install/extra/extension/moment/. tmp/project/app/extension/moment/
  - cp -a install/extra/shared/service/date/. tmp/project/app/shared/service/date/
  - cp -a install/extra/extension/lodash/. tmp/project/app/extension/lodash/
  - cp -a install/extra/shared/service/_/. tmp/project/app/shared/service/_/
  - cp -a install/extra/extension/angular-translate/. tmp/project/app/extension/angular-translate/
  - cp -a install/extra/shared/service/locale/. tmp/project/app/shared/service/locale/
  - cp -a install/extra/extension/restangular/. tmp/project/app/extension/restangular/
  - cp -a install/extra/shared/service/promise/. tmp/project/app/shared/service/promise/
  - cp -a install/extra/extension/ng-file-upload/. tmp/project/app/extension/ng-file-upload/
  - cp -a install/extra/shared/service/upload/. tmp/project/app/shared/service/upload/
  - cp -a install/extra/extension/immutable/. tmp/project/app/extension/immutable/
  - cp -a install/extra/shared/service/data/. tmp/project/app/shared/service/data/
  - cp -a install/extra/extension/teleprint/. tmp/project/app/extension/teleprint/
  - cp -a install/extra/shared/service/print/. tmp/project/app/shared/service/print/
  - cd ../../
  - cd node_modules/rectangular/ && yarn --ignore-engines --ignore-platform && cd ../../
  - cp -a node_modules/rectangular/tmp/project/. .
  - cp .envrc .env
  - cd node_modules/rectangular && rm -rf tmp && mkdir tmp && cd ../../
  - . ~/.nvm/nvm.sh && nvm use && yarn --ignore-engines --ignore-platform
  - node_modules/karma/bin/karma start karma.conf.js
