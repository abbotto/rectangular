language: node_js

notifications:
  email: false
  
sudo: false

node_js:
  - "6.11"

env:
  - CXX=g++-4.8

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - g++-4.8

cache:
  directories:
    - node_modules

branches:
  only:
    - master

before_install:
- |
    git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qvE '(^\.)/' || {
      echo "Only dotfiles were updated, stopping build process."
      exit
    }
- |
    git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qvE '(\.md$)|(^(doc))/' || {
      echo "Only docs were updated, stopping build process."
      exit
    }
- |
    git diff --name-only $TRAVIS_COMMIT_RANGE | grep -qE '(rectangular\.js)|(^(install/project))|(^(install/extra))|(^(src))/' || {
      echo "Non-application files were updated, stopping build process."
      exit
    }

script:
  - npm i > /dev/null && node_modules/eslint/bin/eslint.js --quiet --fix --ext .json --ext .js .
  - projectName="ci-app"
  - projectDescription="continuous integration application"
  - projectLicense="MIT"
  - projectAuthor="rectangular"
  - mkdir "$projectName" && cd "$projectName"
  - curl -O -s https://raw.githubusercontent.com/abbotto/rectangular/master/install/extra.js > /dev/null
  - curl -O -s https://raw.githubusercontent.com/abbotto/rectangular/master/install/package.js > /dev/null
  - curl -O -s https://raw.githubusercontent.com/abbotto/rectangular/master/install/project/package.json > /dev/null
  - node package.js "$projectName" "$projectDescription" "$projectLicense" "$author" && rm package.js
  - npm i
  - cp -a node_modules/rectangular/install/project/. .
  - npm i --save bootstrap angular-strap angular-material bluebird moment angular-moment lodash angular-translate react react-dom react-dom restangular ng-file-upload teleprint
  - mkdir app/extension/ui/
  - mkdir app/extension/promise/
  - mkdir app/extension/component/
  - mkdir app/extension/date/
  - mkdir app/extension/_/
  - mkdir app/extension/locale/
  - mkdir app/extension/rest/
  - mkdir app/extension/upload/
  - mkdir app/extension/print/
  - cp -a node_modules/rectangular/install/extra/extension/ui/bootstrap/. app/extension/ui/
  - cp -a node_modules/rectangular/install/extra/extension/ui/material-design/. app/extension/ui/
  - cp -a node_modules/rectangular/install/extra/extension/promise/. app/extension/promise/
  - cp -a node_modules/rectangular/install/extra/extension/component/. app/extension/component/
  - cp -a node_modules/rectangular/install/extra/extension/date/. app/extension/date/
  - cp -a node_modules/rectangular/install/extra/extension/_/. app/extension/_/
  - cp -a node_modules/rectangular/install/extra/extension/locale/. app/extension/locale/
  - cp -a node_modules/rectangular/install/extra/extension/rest/. app/extension/rest/
  - cp -a node_modules/rectangular/install/extra/extension/upload/. app/extension/upload/
  - cp -a node_modules/rectangular/install/extra/extension/print/. app/extension/print/
  - npm run test
